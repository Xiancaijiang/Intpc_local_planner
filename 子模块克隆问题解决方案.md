# 子模块克隆问题解决方案

## 问题分析

在执行 `git clone --recursive https://github.com/Xiancaijiang/Intpc_local_planner.git` 时遇到的问题，主要原因如下：

### 1. 嵌套子模块

项目中包含嵌套的子模块结构，特别是：
- `src/rm_localization/FAST_LIO` 包含嵌套子模块 `include/ikd-Tree`

当使用 `git clone --recursive` 时，Git 可能无法正确处理多层嵌套的子模块。

### 2. 认证问题

从错误信息 `Username for 'https://github.com':` 可以看出，克隆过程中遇到了 GitHub 认证问题。这通常发生在：
- 尝试访问私有仓库时
- 网络环境限制（如公司防火墙）
- 凭证存储配置不当

### 3. 子模块依赖关系

某些子模块可能依赖于其他子模块，需要特定的初始化顺序。

## 解决方案

### 方法一：分步克隆（推荐）

1. **克隆主仓库**
   ```bash
   git clone https://github.com/Xiancaijiang/Intpc_local_planner.git
   cd Intpc_local_planner
   ```

2. **初始化所有子模块**
   ```bash
   git submodule init
   ```

3. **更新所有子模块**
   ```bash
   git submodule update
   ```

4. **处理嵌套子模块**
   ```bash
   git submodule foreach --recursive git submodule init
   git submodule foreach --recursive git submodule update
   ```

### 方法二：使用SSH协议（避免HTTPS认证问题）

如果您有GitHub SSH密钥配置，可以使用SSH协议克隆：

```bash
# 修改子模块URL为SSH格式
git config submodule.src/rm_navigation/costmap_converter.url git@github.com:LihanChen2004/costmap_converter.git
git config submodule.src/rm_navigation/teb_local_planner.url git@github.com:rst-tu-dortmund/teb_local_planner.git
git config submodule.src/rm_localization/FAST_LIO.url git@github.com:LihanChen2004/FAST_LIO.git
git config submodule.src/rm_localization/point_lio.url git@github.com:LihanChen2004/Point-LIO.git
git config submodule.src/rm_localization/FAST_LIO/include/ikd-Tree.url git@github.com:hku-mars/ikd-Tree.git

# 然后更新子模块
git submodule update --recursive
```

### 方法三：配置凭证存储

```bash
# 启用凭证存储
git config --global credential.helper store

# 然后执行克隆或更新操作
# 首次需要输入用户名密码，之后会自动保存
```

## 验证克隆结果

执行以下命令验证所有子模块是否正确克隆：

```bash
git submodule status
```

所有子模块都应该显示为已初始化（没有 `-` 前缀），例如：
```
 8cb0fa51e336bf8d89648a81ff1f54b98c625d28 src/rm_driver/livox_ros_driver2 (8cb0fa5)
 d43ba685e88e6da05178bdafde8d959cf00e0fad src/rm_localization/FAST_LIO (remotes/origin/RM2024_SMBU_auto_sentry)
 e2e3f4e9d3b95a9e66b1ba83dc98d4a05ed8a3c4 src/rm_localization/FAST_LIO/include/ikd-Tree (remotes/origin/fast_lio)
 580226ca0e76a122167cc729631c2005efa8f593 src/rm_localization/point_lio (remotes/origin/RM2024_SMBU_auto_sentry)
 fdb7cdb85d43fc4cda139409a6bb393ec976bc36 src/rm_navigation/costmap_converter (0.1.2-2-gfdb7cdb)
 630a22e88dc9fd45be726a762edbb5b776bef231 src/rm_navigation/teb_local_planner (0.8.4-59-g630a22e)
```

## 常见问题排查

### 1. 子模块目录为空

如果某个子模块目录为空，尝试：
```bash
# 移除空文件夹
rm -rf src/rm_navigation/costmap_converter

# 重新克隆该子模块
git submodule update --init --recursive src/rm_navigation/costmap_converter
```

### 2. 认证失败

如果遇到认证问题，可以尝试：
- 检查网络连接
- 确保GitHub账户有相应仓库的访问权限
- 尝试使用SSH协议代替HTTPS

### 3. 嵌套子模块更新失败

对于嵌套子模块，可以进入具体目录手动更新：
```bash
cd src/rm_localization/FAST_LIO
git submodule update --init include/ikd-Tree
```

## 总结

使用分步克隆的方法可以有效避免递归克隆时可能遇到的嵌套子模块和认证问题。如果仍然遇到问题，可以尝试：
1. 检查网络环境
2. 验证GitHub凭证
3. 手动处理每个子模块

通过以上方法，应该能够成功克隆包含所有子模块的完整仓库。